# デザインパターン

## 概要

デザインパターンは、繰り返し発生するUI課題に対する検証済みの解決策です。本ガイドラインでは、8つの主要なデザインパターンを定義します。

## 視線誘導

ユーザーの視線の流れを設計し、重要な情報へ自然に導くパターンです。

### 基本法則

#### 1. 視線は上から下に移動する

| パターン | 特徴 | 適用場面 |
|----------|------|----------|
| F型 | 左上から右へ、そして下へ繰り返し | 一覧画面、設定画面、情報が上下に並ぶ画面 |
| Z型 | 左上から右上、左下から右下へ | モーダル、ログイン画面、初見やスクロールが少ない画面 |

#### 2. 視線は大きいものから小さいものへ移動する

見出しレベルを順序立てて使用し、内側の余白を外側より狭くすることで階層的な視線誘導を実現します。

### 実装上の注意点

- ユーザーが明確な目的を持つ場合、法則は機能しないことを認識する
- 複数の法則が相互作用することを意識する
- 見出しや余白で「視線移動の起点・境界」を設定する
- デバイスや画面幅による効果の変動を考慮する
- アクセシビリティ対応と併用し、視線誘導のみに依存しない

## 視覚的グルーピング

関連性のある複数の要素に視覚的なまとまりを持たせるパターンです。

### 3つの表現方法

| 手法 | 特徴 | 使用場面 |
|------|------|----------|
| 余白 | 画面の複雑性を抑制 | 関連度による要素配置が可能な場合 |
| 矩形 | グループ範囲を明確化 | 複数の子グループを含む場合 |
| 罫線 | 明確な境界を表示 | 余白・矩形では対応困難な場合の最終手段 |

### 階層構造

```
セクション（見出し + コンテンツ）
└── ブロック（セクション内のグループ）
    └── 要素
```

### 設計指針

- **一貫性の維持**: 同じ階層の要素には同じグルーピング手法を適用
- **階層の深さに注意**: 深くなるほど情報の関係性の把握が難しくなる
- **TabBar/SideNav活用**: 複数セクションの切り替えには専用コンポーネントを使用

## ページレイアウト

ページ全体の構成を設計するパターンです。

### 基本構成

```
┌─────────────────────────────┐
│         AppHeader           │
├─────────────────────────────┤
│ Container                   │
│ ┌─────────────────────────┐ │
│ │ ページタイトル + リード文│ │
│ ├─────────────────────────┤ │
│ │                         │ │
│ │      メインコンテンツ   │ │
│ │                         │ │
│ └─────────────────────────┘ │
└─────────────────────────────┘
```

### 6つのレイアウトタイプ

| タイプ | 説明 | 用途 |
|--------|------|------|
| Collection (Table/List) | オブジェクトの一覧表示 | 記事一覧、ユーザーリスト |
| Single (1-Column) | 並列的な情報のセクション | 詳細ページ、設定画面 |
| Single (2-Column) | 主/副情報の区別 | プロフィール、ダッシュボード |
| Single (Custom View) | 2Dインタラクティブコンテンツ | マップ、チャート |
| Side Navigation + Content | 広範なナビゲーション | 設定、ドキュメント |
| Collection + Single | リスト・詳細のペア表示 | メール、チャット |

### リード文

ヘッダーエリアにリード文を実装し、ユーザーがページの目的を素早く把握できるようにします。

```tsx
<header>
  <h1>記事一覧</h1>
  <p className="text-text-secondary">
    公開中の記事を管理できます。新しい記事を作成したり、既存の記事を編集できます。
  </p>
</header>
```

### ページ長の管理

過度に長い縦スクロールを避ける方法：

- ディスクロージャーでコンテンツを折りたたむ
- TabBar、SideNav、SideMenuでページを分割
- 情報密度を下げる

## モバイルレイアウト

スマートフォン向けのUI設計パターンです。

### 基本原則

| 項目 | デスクトップ | モバイル |
|------|-------------|---------|
| カラム | マルチカラム可 | シングルカラム推奨 |
| スクロール | 2D可（マップ等） | 縦スクロールのみ推奨 |
| 情報量 | 詳細表示可 | 厳選した情報のみ |
| 操作 | 複数操作可 | シンプルな操作に限定 |

### 設計アプローチ

```tsx
// レスポンシブ vs アダプティブ
// レスポンシブ: 同じ要素、構造、データでレイアウトのみ変更
// アダプティブ: 画面幅やデバイスに応じて構造、データ、表現を変更
```

### 実装

```tsx
// モバイル判定
const { isMobile } = useEnvironment();

// レスポンシブクラス
<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3">
  {/* カード */}
</div>
```

## フィードバック

ユーザーの操作に対する応答を設計するパターンです。

### 基本原則

| 原則 | 説明 |
|------|------|
| 受動的認識 | ユーザーが能動的に確認しなくても結果がわかる |
| 近接表示 | 操作した要素の近くにフィードバックを表示 |
| スクリーンリーダー対応 | 適切な読み上げ順序を維持 |

### フィードバックのパターン

#### フォーム入力・送信

```tsx
// バリデーションエラー
<FormControl error={!!errors.email}>
  <Label>メールアドレス</Label>
  <Input {...register("email")} />
  {errors.email && <ErrorMessage>{errors.email.message}</ErrorMessage>}
</FormControl>
```

#### 処理中状態

```tsx
<Button loading={isSubmitting}>
  {isSubmitting ? "送信中..." : "送信する"}
</Button>
```

#### 完了通知

```tsx
// 成功時
<ResponseMessage status="success">
  保存しました
</ResponseMessage>

// エラー時
<ResponseMessage status="error">
  保存に失敗しました。再度お試しください。
</ResponseMessage>
```

## モーダルUI

特定のタスクを完了させるためのモード付きUIパターンです。

### 使用場面

| 場面 | 例 |
|------|-----|
| オブジェクトの追加・編集 | 記事作成、プロフィール編集 |
| データの並べ替え | 一覧のソート設定 |
| データの取り込み・書き出し | CSVインポート/エクスポート |
| 破壊的処理の確認 | 削除確認 |
| 複雑な一連操作 | ウィザード |

### 実装パターン

| パターン | コンポーネント | 用途 |
|----------|--------------|------|
| モーダルダイアログ | Dialog | 小〜中規模のフォーム |
| ページ全体モード | FloatArea | 情報量が多い場合 |
| ページ部分モード | Drawer | 元のレイアウト認知を維持 |
| ステップ分割 | StepFormDialog | 複数ステップの操作 |

### 構成要素

```tsx
<Dialog>
  <DialogTitle>記事を作成</DialogTitle>
  <DialogDescription>新しい記事の情報を入力してください。</DialogDescription>

  <DialogContent>
    <FormControl>
      <Label>タイトル</Label>
      <Input />
    </FormControl>
  </DialogContent>

  <DialogActions>
    <Button variant="ghost" onClick={onCancel}>キャンセル</Button>
    <Button onClick={onSubmit}>作成する</Button>
  </DialogActions>
</Dialog>
```

### アクセシビリティ

**完了ボタンの無効化は避ける**。入力不備がある場合も、ユーザーにボタンを押させてからエラーフィードバックを表示します。

## ウィザード

複数ステップに分けて操作を完了させるパターンです。

### 使用場面

| 場面 | 例 |
|------|-----|
| 複雑な操作 | オブジェクトの検索と選択、ファイル編集 |
| 条件分岐がある場合 | 入力内容によって後続項目が変わる |
| パラメーター入力を伴う確認操作 | 削除前の条件設定 |

### 基本原則

- **乱用を避ける**: ユーザー行動を制限するため、特に有効な場合に限定
- **進捗表示**: 全体のステップ数と現在のステップを常に表示

### 実装

```tsx
<StepFormDialog
  currentStep={currentStep}
  totalSteps={3}
  title={`記事のインポート (${currentStep}/3)`}
>
  {currentStep === 1 && <Step1 />}
  {currentStep === 2 && <Step2 />}
  {currentStep === 3 && <Step3 />}

  <DialogActions>
    {currentStep > 1 && (
      <Button variant="ghost" onClick={onBack}>戻る</Button>
    )}
    <Button variant="ghost" onClick={onCancel}>キャンセル</Button>
    {currentStep < 3 ? (
      <Button onClick={onNext}>次へ</Button>
    ) : (
      <Button onClick={onComplete}>インポートする</Button>
    )}
  </DialogActions>
</StepFormDialog>
```

## 権限による表示制御

ユーザーの権限に応じてUIの表示・非表示を制御するパターンです。

### 4つのパターン

| パターン | 対応 | 例 |
|----------|------|-----|
| A | UIを非表示、理由も非表示 | 権限なしユーザーには機能自体を見せない |
| B | UIを非表示にし、その理由を明示 | システム標準権限（削除不可）の説明 |
| C | UIはdisabledとし、その理由を明示 | 使用中のため削除不可 |
| D | UIを表示・操作可能 | 通常状態 |

### 理由の表示方法

```tsx
// Tooltipで理由を表示
<Tooltip content="この権限はシステムで使用されているため削除できません">
  <Button disabled>削除</Button>
</Tooltip>

// disabledReasonを使用
<Button
  disabled
  disabledReason="編集中のユーザーがいるため削除できません"
>
  削除
</Button>
```

### ライティング基本方針

| 状況 | 表現 |
|------|------|
| ユーザーが対応可能 | 「〜がないので、〜できません」 |
| ユーザーが対応不可 | 「〜できません」 |

## 参考リンク

- [デザイン原則](./design-principles.md)
- [アクセシビリティガイドライン](./accessibility.md)
- [CSS ガイドライン](../css.md)
